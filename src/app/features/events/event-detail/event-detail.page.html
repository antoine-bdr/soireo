<!-- ========================================
     üé® EVENT DETAIL - DARK PREMIUM GLASSMORPHISM
     ‚úÖ VERSION AVEC BADGE TYPE D'√âV√âNEMENT
     ======================================== -->

<!-- ========================================
     LOADING STATE
     ======================================== -->
     <div class="loading-container" *ngIf="isLoading">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
      <p>Chargement de l'√©v√©nement...</p>
    </div>
    
    <!-- ========================================
         CONTENT PRINCIPAL
         ======================================== -->
    <ion-content [fullscreen]="true" *ngIf="!isLoading && event">
    
      <!-- ========================================
           IMAGE HEADER FULL-WIDTH
           ======================================== -->
      <div class="event-image-header">
        <img 
          [src]="event.imageUrl || 'assets/placeholder-event.jpg'" 
          [alt]="event.title"
          class="header-image" />
        
        <!-- Gradient overlay -->
        <div class="image-overlay"></div>
        
        <!-- Bouton retour flottant -->
        <ion-button 
          class="back-button"
          fill="clear"
          (click)="goBack()">
          <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
        </ion-button>
    
        <!-- Badges flottants -->
        <div class="floating-badges">
          <!-- Badge Organisateur -->
          <ion-badge 
            class="floating-badge organizer-badge" 
            *ngIf="isOrganizer"
            color="warning">
            ‚≠ê Organisateur
          </ion-badge>
    
          <!-- Badge Complet -->
          <ion-badge 
            class="floating-badge full-badge" 
            *ngIf="isEventFull()"
            color="danger">
            üîí COMPLET
          </ion-badge>
    
          <!-- Badge Participant -->
          <ion-badge 
            class="floating-badge participating-badge" 
            *ngIf="isParticipating && !isOrganizer"
            color="success">
            ‚úì Inscrit
          </ion-badge>
    
          <!-- Badge Priv√© -->
          <ion-badge 
            class="floating-badge private-badge" 
            *ngIf="event.isPrivate"
            color="dark">
            üîí Priv√©
          </ion-badge>
    
          <!-- Badge Adresse Masqu√©e -->
          <ion-badge 
            class="floating-badge masked-badge" 
            *ngIf="isAddressMasked()"
            color="medium">
            üîí Adresse masqu√©e
          </ion-badge>
        </div>
      </div>
    
      <!-- ========================================
           CONTENU PRINCIPAL
           ======================================== -->
      <div class="detail-content">
    
        <!-- ========================================
             CARD INFO PRINCIPALE
             ======================================== -->
        <ion-card class="info-card glassmorphism">
          <ion-card-content>
            
            <!-- Titre -->
            <h1 class="event-title">{{ event.title }}</h1>
    
            <!-- ‚úÖ MODIFICATION : Badges cat√©gorie, type d'acc√®s et participants -->
            <div class="inline-badges">
              <ion-chip class="category-chip">
                <ion-label>{{ getCategoryLabel(event.category) }}</ion-label>
              </ion-chip>
    
              <!-- ‚úÖ NOUVEAU : Badge type d'√©v√©nement -->
              <ion-chip 
                class="access-type-chip"
                [attr.data-access-type]="getEventAccessType()">
                <ion-icon [name]="getAccessTypeIcon()"></ion-icon>
                <ion-label>{{ getAccessTypeLabel() }}</ion-label>
              </ion-chip>
    
              <ion-chip 
                [attr.data-status]="getParticipantBadgeStatus()"
                class="participants-chip">
                <ion-icon name="people-outline"></ion-icon>
                <ion-label>
                  {{ participantCount }}/{{ event.maxParticipants }}
                </ion-label>
              </ion-chip>
            </div>
    
            <!-- Metadata (date + lieu) -->
            <div class="event-metadata">
              <!-- Date -->
              <div class="meta-item">
                <ion-icon name="calendar-outline"></ion-icon>
                <div class="meta-text">
                  <span class="meta-label">Date</span>
                  <span class="meta-value">{{ formatDate(event.date) }}</span>
                </div>
              </div>
    
              <!-- Lieu avec gestion conditionnelle -->
              <div class="meta-item">
                <ion-icon 
                  [name]="isAddressMasked() ? 'eye-off-outline' : 'location-outline'">
                </ion-icon>
                <div class="meta-text">
                  <span class="meta-label">Lieu</span>
                  
                  <!-- Adresse compl√®te (si visible) -->
                  <span 
                    class="meta-value" 
                    *ngIf="!isAddressMasked()">
                    {{ getAddressDisplay() }}
                  </span>
                  
                  <!-- Ville uniquement (si masqu√©e) -->
                  <span 
                    class="meta-value address-masked" 
                    *ngIf="isAddressMasked()">
                    üìç {{ getAddressDisplay() }}
                  </span>
                </div>
              </div>
            </div>
    
            <!-- Message explicatif si adresse masqu√©e -->
            <div class="location-message-box" *ngIf="isAddressMasked()">
              <ion-icon name="information-circle-outline" color="primary"></ion-icon>
              <p>{{ getLocationMessage() }}</p>
            </div>
    
          </ion-card-content>
        </ion-card>
    
        <!-- ========================================
             BOUTON PARTICIPATION
             ======================================== -->
        <div class="action-section" *ngIf="!isOrganizer">
          
          <!-- √âTAT 1 : NON INSCRIT - Bouton Participer -->
          <ion-button 
            *ngIf="!isParticipating && !isPending() && !isEventFull()"
            expand="block"
            class="participate-button"
            (click)="joinEvent()">
            <ion-icon name="person-add-outline" slot="start"></ion-icon>
            Participer √† cet √©v√©nement
          </ion-button>
    
          <!-- √âTAT 2 : DEMANDE EN ATTENTE (PENDING) -->
          <div *ngIf="isPending()" class="pending-status-container">
            <!-- Badge statut -->
            <div class="pending-badge-box">
              <ion-icon name="time-outline" color="warning"></ion-icon>
              <div class="pending-text">
                <h4>Demande envoy√©e</h4>
                <p>L'organisateur doit approuver votre participation</p>
              </div>
            </div>
    
            <!-- Bouton Annuler la demande -->
            <ion-button 
              expand="block"
              class="cancel-request-button"
              fill="outline"
              color="warning"
              (click)="cancelRequest()">
              <ion-icon name="close-circle-outline" slot="start"></ion-icon>
              Annuler la demande
            </ion-button>
          </div>
    
          <!-- √âTAT 3 : APPROUV√â - Bouton Se d√©sinscrire -->
          <div *ngIf="isParticipating && !isPending()" class="approved-status-container">
            <!-- Badge confirmation -->
            <div class="approved-badge-box">
              <ion-icon name="checkmark-circle-outline" color="success"></ion-icon>
              <span>Vous participez √† cet √©v√©nement</span>
            </div>
    
            <!-- Bouton Se d√©sinscrire -->
            <ion-button 
              expand="block"
              class="leave-button"
              fill="outline"
              color="danger"
              (click)="leaveEvent()">
              <ion-icon name="exit-outline" slot="start"></ion-icon>
              Se d√©sinscrire
            </ion-button>
          </div>
    
          <!-- MESSAGE COMPLET -->
          <div class="full-message" *ngIf="isEventFull() && !isParticipating && !isPending()">
            <ion-icon name="warning-outline"></ion-icon>
            <p>Cet √©v√©nement est complet</p>
          </div>
        </div>
    
        <!-- ========================================
             CARD ORGANISATEUR
             ======================================== -->
        <ion-card class="organizer-card glassmorphism">
          <ion-card-content>
            <h3 class="section-title">
              <ion-icon name="person-outline"></ion-icon>
              Organisateur
            </h3>
    
            <div class="organizer-info">
              <ion-avatar class="organizer-avatar">
                <img 
                  [src]="event.organizerPhoto || 'assets/default-avatar.png'" 
                  [alt]="event.organizerName" />
              </ion-avatar>
              <div class="organizer-details">
                <p class="organizer-name">{{ event.organizerName }}</p>
                <p class="organizer-label">Cr√©ateur de l'√©v√©nement</p>
              </div>
            </div>
          </ion-card-content>
        </ion-card>
    
        <!-- ========================================
             CARD DESCRIPTION
             ======================================== -->
        <ion-card class="description-card glassmorphism">
          <ion-card-content>
            <h3 class="section-title">
              <ion-icon name="document-text-outline"></ion-icon>
              Description
            </h3>
            <p class="description-text">{{ event.description }}</p>
          </ion-card-content>
        </ion-card>
    
        <!-- ========================================
             CARD DEMANDES EN ATTENTE (Organisateur uniquement)
             ======================================== -->
        <ion-card 
          class="pending-requests-card glassmorphism" 
          *ngIf="isOrganizer && event.requiresApproval && pendingCount > 0">
          <ion-card-content>
            <div class="pending-header">
              <h3 class="section-title">
                <ion-icon name="notifications-outline"></ion-icon>
                Demandes en attente
              </h3>
              <ion-badge color="danger" class="pending-badge">
                {{ pendingCount }}
              </ion-badge>
            </div>
            
            <p class="pending-description">
              {{ pendingCount }} personne(s) souhaite(nt) rejoindre votre √©v√©nement
            </p>
    
            <ion-button
              expand="block"
              (click)="openPendingRequestsModal()"
              class="manage-requests-button">
              <ion-icon name="notifications-outline" slot="start"></ion-icon>
              G√©rer les demandes
            </ion-button>
          </ion-card-content>
        </ion-card>
    
        <!-- ========================================
             CARD PARTICIPANTS
             ======================================== -->
        <ion-card class="participants-card glassmorphism" *ngIf="participants.length > 0">
          <ion-card-content>
            <h3 class="section-title">
              <ion-icon name="people-outline"></ion-icon>
              Participants ({{ participantCount }})
            </h3>
    
            <div class="participants-grid">
              <div 
                class="participant-item" 
                *ngFor="let participant of participants">
                <ion-avatar class="participant-avatar">
                  <img 
                    [src]="participant.userPhoto || 'assets/default-avatar.png'" 
                    [alt]="participant.userName" />
                </ion-avatar>
                <p class="participant-name">{{ participant.userName }}</p>
              </div>
            </div>
          </ion-card-content>
        </ion-card>
    
        <!-- ========================================
             ACTIONS ORGANISATEUR
             ======================================== -->
        <div class="organizer-actions" *ngIf="isOrganizer">
          <ion-button 
            expand="block"
            class="edit-button"
            (click)="editEvent()">
            <ion-icon name="create-outline" slot="start"></ion-icon>
            Modifier l'√©v√©nement
          </ion-button>
    
          <ion-button 
            expand="block"
            class="delete-button"
            fill="outline"
            color="danger"
            (click)="deleteEvent()">
            <ion-icon name="trash-outline" slot="start"></ion-icon>
            Supprimer l'√©v√©nement
          </ion-button>
        </div>
    
        <!-- Spacing bottom -->
        <div class="bottom-spacing"></div>
    
      </div>
    
    </ion-content>