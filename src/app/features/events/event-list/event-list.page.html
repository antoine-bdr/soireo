<!-- src/app/features/events/event-list/event-list.page.html -->
<!-- Page liste avec BADGES PARTICIPANTS (√âTAPE 6) -->

<ion-header>
  <ion-toolbar color="primary">
    <ion-title>üéâ √âv√©nements</ion-title>
    <ion-buttons slot="end">
      <ion-button [routerLink]="['/my-events']">
        <ion-icon name="person-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Barre de recherche -->
  <ion-toolbar>
    <ion-searchbar
      placeholder="Rechercher un √©v√©nement..."
      (ionInput)="onSearchChange($event)"
      [debounce]="500">
    </ion-searchbar>
  </ion-toolbar>

  <!-- Segments de filtrage -->
  <ion-toolbar>
    <ion-segment 
      [value]="selectedSegment()" 
      (ionChange)="onSegmentChange($event)">
      <ion-segment-button value="upcoming">
        <ion-label>√Ä venir</ion-label>
      </ion-segment-button>
      <ion-segment-button value="all">
        <ion-label>Tous</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content>
  
  <!-- Pull-to-refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Loader pendant le chargement -->
  <div class="loading-container" *ngIf="isLoading()">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>Chargement des √©v√©nements...</p>
  </div>

  <!-- Liste des √©v√©nements -->
  <div class="events-container" *ngIf="!isLoading()">
    
    <!-- Message si aucun √©v√©nement -->
    <div class="empty-state" *ngIf="filteredEvents().length === 0">
      <ion-icon name="calendar-outline" color="medium"></ion-icon>
      <h2>Aucun √©v√©nement</h2>
      <p *ngIf="searchTerm()">
        Aucun r√©sultat pour "{{ searchTerm() }}"
      </p>
      <p *ngIf="!searchTerm()">
        Sois le premier √† cr√©er un √©v√©nement !
      </p>
      <ion-button (click)="goToCreateEvent()">
        <ion-icon name="add-outline" slot="start"></ion-icon>
        Cr√©er un √©v√©nement
      </ion-button>
    </div>

    <!-- Cards des √©v√©nements -->
    <ion-card 
      *ngFor="let event of filteredEvents()" 
      class="event-card"
      (click)="goToEventDetail(event.id!)">
      
      <!-- Image de l'√©v√©nement -->
      <div class="event-image-container">
        <img 
          [src]="event.imageUrl || 'assets/placeholder-event.jpg'" 
          [alt]="event.title"
          class="event-image" />
        
        <!-- üÜï Badge "Complet" si l'√©v√©nement est plein -->
        <ion-badge 
          class="full-badge" 
          color="danger" 
          *ngIf="isEventFull(event)">
          ‚ö†Ô∏è Complet
        </ion-badge>

        <!-- Badge "Priv√©" -->
        <ion-badge 
          class="private-badge" 
          color="dark" 
          *ngIf="event.isPrivate">
          üîí Priv√©
        </ion-badge>
      </div>

      <ion-card-header>
        <!-- En-t√™te avec cat√©gorie et badge participants -->
        <div class="header-badges">
          <!-- Cat√©gorie -->
          <ion-chip [color]="getCategoryColor(event.category)">
            <ion-label>{{ getCategoryLabel(event.category) }}</ion-label>
          </ion-chip>

          <!-- üÜï NOUVEAU : Badge compteur participants -->
          <ion-chip [color]="getParticipantBadgeColor(event)" class="participants-badge">
            <ion-icon name="people-outline"></ion-icon>
            <ion-label>
              {{ getParticipantCount(event.id!) }} / {{ event.maxParticipants }}
            </ion-label>
          </ion-chip>
        </div>

        <!-- Titre -->
        <ion-card-title>{{ event.title }}</ion-card-title>

        <!-- Organisateur -->
        <ion-card-subtitle>
          Par {{ event.organizerName }}
        </ion-card-subtitle>
      </ion-card-header>

      <ion-card-content>
        <!-- Description (tronqu√©e) -->
        <p class="event-description">
          {{ event.description.length > 100 
             ? event.description.substring(0, 100) + '...' 
             : event.description }}
        </p>

        <!-- Informations -->
        <div class="event-info">
          <!-- Date -->
          <div class="info-item">
            <ion-icon name="calendar-outline" color="primary"></ion-icon>
            <ion-text>{{ formatDate(event.date) }}</ion-text>
          </div>

          <!-- Lieu -->
          <div class="info-item">
            <ion-icon name="location-outline" color="danger"></ion-icon>
            <ion-text>{{ event.location.city }}</ion-text>
          </div>
        </div>

        <!-- Bouton Voir d√©tails -->
        <ion-button 
          expand="block" 
          fill="outline" 
          class="ion-margin-top"
          (click)="goToEventDetail(event.id!); $event.stopPropagation()">
          Voir les d√©tails
        </ion-button>
      </ion-card-content>
    </ion-card>

  </div>

  <!-- Bouton flottant pour cr√©er un √©v√©nement -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="goToCreateEvent()">
      <ion-icon name="add-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>

</ion-content>