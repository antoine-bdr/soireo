<!-- ========================================
     ‚ú® EVENT LIST - VERSION CORRIG√âE AVEC DEBUG
     ======================================== -->

<ion-header [translucent]="true">
  <ion-toolbar>
    <!-- Titre -->
    <ion-title>üéâ √âv√©nements</ion-title>
    
    <!-- Bouton filtres -->
    <ion-buttons slot="end">
      <ion-button (click)="openFiltersModal()">
        <ion-badge 
          *ngIf="activeFiltersCount() > 0" 
          color="danger"
          class="filter-badge">
          {{ activeFiltersCount() }}
        </ion-badge>
        <ion-icon name="funnel-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- ‚úÖ CORRIG√â : Searchbar avec searchValue au lieu de searchTerm() -->
  <ion-toolbar>
    <ion-searchbar
      placeholder="Rechercher un √©v√©nement..."
      (ionInput)="onSearchChange($event)"
      [debounce]="500"
      [value]="searchValue()">
    </ion-searchbar>
  </ion-toolbar>

  <!-- ========================================
       CHIPS DES FILTRES ACTIFS
       ======================================== -->
  <app-active-filters-chips></app-active-filters-chips>

  <!-- Segments -->
  <ion-toolbar>
    <ion-segment 
      [value]="selectedSegment()" 
      (ionChange)="onSegmentChange($event)">
      <ion-segment-button value="upcoming">
        <ion-label>√Ä venir</ion-label>
      </ion-segment-button>
      <ion-segment-button value="all">
        <ion-label>Tous</ion-label>
      </ion-segment-button>
      <ion-segment-button value="past">
        <ion-label>Pass√©s</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  
  <!-- Pull-to-refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- ========================================
       COMPTEUR DE R√âSULTATS
       ======================================== -->
  <div class="results-counter" *ngIf="!isLoading()">
    <ion-text>
      <p>
        <strong>{{ filteredEvents().length }}</strong> 
        √©v√©nement{{ filteredEvents().length > 1 ? 's' : '' }} trouv√©{{ filteredEvents().length > 1 ? 's' : '' }}
        <span *ngIf="allEvents().length > 0" class="total-count">
          sur {{ allEvents().length }} total
        </span>
      </p>
    </ion-text>
  </div>

  <!-- ========================================
       LOADING STATE
       ======================================== -->
  <div class="loading-container" *ngIf="isLoading()">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
    <p>Chargement des √©v√©nements...</p>
  </div>

  <!-- ========================================
       EVENTS LIST
       ======================================== -->
  <div class="events-container" *ngIf="!isLoading()">
    
    <!-- ========================================
         EMPTY STATE
         ======================================== -->
    <div class="empty-state" *ngIf="filteredEvents().length === 0">
      <ion-icon name="calendar-outline"></ion-icon>
      <h2>Aucun √©v√©nement</h2>
      
      <!-- Message diff√©rent selon contexte -->
      <p *ngIf="activeFiltersCount() > 0">
        Aucun r√©sultat ne correspond √† vos crit√®res.
        <br>
        <small>Essayez de modifier ou supprimer certains filtres.</small>
      </p>
      <p *ngIf="activeFiltersCount() === 0 && searchValue()">
        Aucun r√©sultat pour "{{ searchValue() }}"
      </p>
      <p *ngIf="activeFiltersCount() === 0 && !searchValue()">
        Sois le premier √† cr√©er un √©v√©nement !
      </p>
      
      <!-- Actions -->
      <div class="empty-actions">
        <ion-button 
          *ngIf="activeFiltersCount() > 0"
          fill="outline"
          (click)="clearFilters()">
          <ion-icon name="close-circle" slot="start"></ion-icon>
          Effacer les filtres
        </ion-button>
        
        <ion-button 
          (click)="goToCreateEvent()">
          <ion-icon name="add-outline" slot="start"></ion-icon>
          Cr√©er un √©v√©nement
        </ion-button>
      </div>
    </div>

    <!-- ========================================
         ‚ú® EVENT CARDS - COMPOSANT R√âUTILISABLE
         ======================================== -->
    <app-event-card
      *ngFor="let event of filteredEvents(); trackBy: trackByEventId"
      [event]="event"
      [participantCount]="getParticipantCount(event.id!)"
      (cardClick)="goToEventDetail($event)">
    </app-event-card>

  </div>

</ion-content>